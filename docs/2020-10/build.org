* Calling redo cat annotations version 2020-10-14:
** build with gencode V33
** dir: /public/home/jcarmstr/public_html/cat_data/primates_jason/REDO/cat/gencode_v33/out/assemblyHub
** URL: http://courtyard.gi.ucsc.edu/~jcarmstr/cat_data/primates_jason/REDO/cat/gencode_v33/out/assemblyHub/hub.txt
* generate blat indexes

for tb in */*.2bit ; do
   g=$(dirname $tb)
   gfServer index -stepSize=5 $g/$g.untrans.gfidx $tb
   gfServer index -trans $g/$g.trans.gfidx $tb
done


* build track hub from assembly hub, renaming sequences to UCSC names
** generate chromosome name mappings from assemblies used in the hub to genome browser
(see http://genomewiki.ucsc.edu/index.php/Chromosome_name_conversion)

Owl_monkey: not in browser or genark hubs
Gibbon: is in genark, not a database, but will work.



# create genomes/genomes.lst with
Chimp Bonobo Gorilla Orangutan Rhesus Marmoset Human Gibbon


# genomes/genomeMap.lst:
Bonobo	panPan3
Chimp	panTro6
Gorilla	gorGor6
Marmoset	calJac4
Orangutan	ponAbe3
Rhesus	rheMac10
Human	hg38

# this runs parasol
cd mkkeys
mkdir $(cat ../genomes/genomes.lst )
for g in $(cat ../genomes/genomes.lst) ; do (~/kent/src/hg/utils/automation/doIdKeys.pl -buildDir=$(pwd)/$g -twoBit=$(pwd)/../genomes/$g.2bit $g&) ; done

# compare pairs of hubname browsername, need 3rd col
    join -t $'\t' \
        mkkeys/$1/$1.idKeys.txt \
        /hive/data/genomes/$2/bed/idKeys/$2.idKeys.txt | tawk '{print $2,$3}'  >mappings/$1.mapping

# must do gibbon separately do to being in genark GCF_006542625.1
cd GCF_006542625.1
https://hgdownload.soe.ucsc.edu/hubs/GCF/006/542/625/GCF_006542625.1/GCF_006542625.1.2bit
~/kent/src/hg/utils/automation/doIdKeys.pl -buildDir=$(pwd) -twoBit=$(pwd)/GCF_006542625.1.2bit GCF_006542625.1
cd ../..
join -t $'\t' \
    mkkeys/Gibbon/Gibbon.idKeys.txt  mkkeys/GCF_006542625.1/GCF_006542625.1.idKeys.txt  | tawk '{print $2,$3}'  >mappings/Gibbon.mapping

** rename sequences, then genomes
for g in $(cat genomes/genomes.lst) ; do halRenameSequences primates_eichler-v2-ucsc.hal $g mappings/$g ; done
halRenameGenomes primates_eichler-v2-ucsc.hal genomes/genomeMap.lst 


** rename hub data files
these hack makes modify BEDs and BAMs
hubs/2020-10/build-tools/doBamRename.mk
hubs/2020-10/build-tools/doBedRename.mk

** copy to courtyard
rsync -a track-hub courtyard:/public/groups/cgl/hubs/primates/2020-10/&

* segdup tracks

UW: Chimp Bonobo Gorilla Orangutan  Gibbon  
WU: Rhesus  Marmoset

* yale pseudopipe predictions
in ~/compbio/kznf/projs/outside-data/pseudopipe/

Callithrix_jacchus.C_jacchus3.2.1.pgene.txt
Gorilla_gorilla.gorGor4.pgene.txt
Macaca_mulatta.Mmul_10.pgene.txt
Pan_paniscus.panpan1.1.pgene.txt
Pan_troglodytes.Pan_tro_3.0.pgene.txt
Pongo_abelii.PPYG2.pgene.txt

# also got GTFs, but they don't have block structure

cd ~/compbio/kznf/projs/primate-test-hub/2020-10/track-hub


../bin/pseudoPipeToBigBed panTro6 ../../outside-data/pseudopipe/Pan_troglodytes.Pan_tro_3.0.pgene.txt pseudopipe.bed

End coordinate 224482623 bigger than chr1 size of 224244399 line 1141 of pseudopipe.bed

chr1	224481603	224482623	ENSPTRP00000033770.3	530	-	224481603	224482623	0,0,139	0.98	11	55	7	4	4e-26	0.53	0	DUP

# hmmm, different assembly for chimp

* pseudopipe vs refseq comparison

|-----------+---------------------+----------------+-----------------+---------+-----------+-------------------------------+-----------------+-----------+-------------+---------|
| common    | organism            | PP name        | PP acc          | PP date | PP status | UCSC name                     | UCSC acc        | UCSC date | UCSC status | Ensembl |
|-----------+---------------------+----------------+-----------------+---------+-----------+-------------------------------+-----------------+-----------+-------------+---------|
| Chimp     | Pan troglodytes     | Pan_tro_3.0    | GCF_000001515.7 | 2016-05 | old       | Clint_PTRv2                   | GCF_002880755.1 |   2018-01 | current     | yes     |
| Bonobo    | Pan paniscus        | panpan1.1      | GCF_000258655.2 | 2015-08 | old       | Mhudiblu_PPA_v0               | GCF_013052645.1 |   2020-05 | current     | old     |
| Gorilla   | Gorilla gorilla     | gorGor4        | GCF_000151905.2 | 2014-12 | old       | Kamilah_GGO_v0                | GCF_008122165.1 |   2019-08 | current     | old     |
| Gibbon    | Nomascus leucogenys |                |                 |         |           | Asia_NLE                      | GCF_006542625.1 |   2019-07 | current     | old     |
| Orangutan | Pongo abelii        | PPYG2          | ???             | 2007-09 | old       | Susie_PABv2                   | GCF_002880775.1 |   2018-01 | current     | yes     |
| Rhesus    | Macaca mulatta      | Mmul_10        | GCF_003339765.1 | 2019-02 | current   | Mmul_10                       | GCF_003339765.1 |   2019-02 | current     | yes     |
| Marmoset  | Callithrix jacchus  | C_jacchus3.2.1 | GCF_000004665.1 | 2010-01 | old       | Callithrix_jacchus_cj1700_1.1 | GCF_009663435.1 |   2020-05 | current     | old     |
|-----------+---------------------+----------------+-----------------+---------+-----------+-------------------------------+-----------------+-----------+-------------+---------|

** columns
- for assembly being used by pseudopipe (PP) or UCSC Browser
  - acc - RefSeq accession of assembly used by Yale.
  - name - pseudopipe assembly name from file name
  - date - date of assembly
  - status - current RefSeq assembly, an older one or there is a new one.
- Ensembl - Does Ensembl have the refseq version UCSC is using

** notes
- I can't determine which NCBI Orangutan assembly corresponds to the Ensembl
  has PPYG2, Sep 2007 in their archive, however I can't find it in NCBI.
  There were occasions were Ensembl released browsers data directly from the
  lab doing the assembly.  This caused so much grief that their is now an
  agreement between the browser groups to only 
- There are new GenBank assemblies of Bonobo and Orangutan, but not RefSeq.
  These are updated to the previous assemblies by the same groups

** summary for Yale
|-----------+---------------------+-----------+-----------------+-------------+---------|
| common    | organism            | PP status | UCSC acc        | UCSC status | Ensembl |
|-----------+---------------------+-----------+-----------------+-------------+---------|
| Chimp     | Pan troglodytes     | old       | GCF_002880755.1 | current     | yes     |
| Bonobo    | Pan paniscus        | old       | GCF_013052645.1 | current     | old     |
| Gorilla   | Gorilla gorilla     | old       | GCF_008122165.1 | current     | old     |
| Gibbon    | Nomascus leucogenys |           | GCF_006542625.1 | current     | old     |
| Orangutan | Pongo abelii        | old       | GCF_002880775.1 | current     | yes     |
| Rhesus    | Macaca mulatta      | current   | GCF_003339765.1 | current     | yes     |
| Marmoset  | Callithrix jacchus  | old       | GCF_009663435.1 | current     | old     |
|-----------+---------------------+-----------+-----------------+-------------+---------|
